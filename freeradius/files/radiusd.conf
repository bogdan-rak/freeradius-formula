# vim: sts=2 ts=2 sw=2 et ai
# GENERATED BY SALT
# -*- text -*-
##
## radiusd.conf	-- FreeRADIUS server configuration file.
##
##	http://www.freeradius.org/
##	$Id$
##
{% from "freeradius/map.jinja" import freeradius with context %}
{% set radiusd_conf = salt['pillar.get']('freeradius:'+configname, {}) %}

prefix = /usr
exec_prefix = /usr
sysconfdir = /etc
localstatedir = /var
sbindir = ${exec_prefix}/sbin
logdir = /var/log/freeradius
raddbdir = /etc/freeradius
radacctdir = ${logdir}/radacct

#
#  name of the running server.  See also the "-n" command-line option.
name = {{ freeradius.name }}

#  Location of config and logfiles.
confdir = ${raddbdir}
run_dir = ${localstatedir}/run/${name}

# Should likely be ${localstatedir}/lib/radiusd
db_dir = ${raddbdir}

libdir = /usr/lib/freeradius
#
pidfile = ${run_dir}/${name}.pid

#
user = {{ freeradius.user }}
group = {{ freeradius.group }}

#
max_request_time = 30

#
cleanup_delay = 5

#
max_requests = 1024

#
{%- for listen_host in radiusd_conf.get("listen", []) %}
listen {
    type = {{ listen_host.type }}
    ipaddr = {{ listen_host.ipaddr }}
    port = {{ listen_host.port }}
}
{%-endfor %}

#
hostname_lookups = no

#
allow_core_dumps = no

#
regular_expressions	= yes
extended_expressions	= yes

log {
	destination = files
	file = ${logdir}/radius.log
	syslog_facility = daemon
	stripped_names = no
	auth = no
	auth_badpass = no
	auth_goodpass = no

}

#  The program to execute to do concurrency checks.
checkrad = ${sbindir}/checkrad

security {
	max_attributes = 200
	reject_delay = 1
	status_server = yes
}

# PROXY CONFIGURATION
proxy_requests  = {{ radiusd_conf.get("proxy_requests","yes")}} 
$INCLUDE proxy.conf


# CLIENTS CONFIGURATION
$INCLUDE clients.conf


# THREAD POOL CONFIGURATION
thread pool {
	start_servers = 5
	max_servers = 32
	min_spare_servers = 3
	max_spare_servers = 10
	max_requests_per_server = 0
}

# MODULE CONFIGURATION
modules {
	$INCLUDE ${confdir}/modules/
{%- for module_path in radiusd_conf.get("modules",[]) %}
      {{ module_path }}
{%- endfor %}
}
#
# Instantiation
instantiate {
	exec
	expr

	#
	# We add the counter module here so that it registers
	# the check-name attribute before any module which sets
	# it
#	daily
  {%- if radiusd_conf.instantiate.options is defined %}
  {%- for elem in radiusd_conf.get("instantiate", []).get("options",[]) %}
      {{ elem }}
  {%- endfor %}
  {%- endif %}

  {%- if radiusd_conf.instantiate.redundants is defined %}
  {%-for redun in radiusd_conf.get("instantiate",[]).get("redundants",[]) %}
    redundant  {{ redun.name }} {
      {%- if redun.group is defined %}
        {%- for item_red in redun.group %}
          group {
            {%- for item_red_gr in item_red %}
              {{ item_red_gr }}
            {%- endfor %}
          }
        {%- endfor %}
      {%- endif %}
      {%- if redun.options is defined %}
        {%- for item_opts in redun.options %}
            {{ item_opts }}
        {%- endfor %}
      {%- endif %}
    }
  {%- endfor %}
  {% endif %}
}

######################################################################
#
#	Policies that can be applied in multiple places are listed
#	globally.  That way, they can be defined once, and referred
#	to multiple times.
#
######################################################################
$INCLUDE policy.conf

######################################################################
#
#	Load virtual servers.
#
#	This next $INCLUDE line loads files in the directory that
#	match the regular expression: /[a-zA-Z0-9_.]+/
#
#	It allows you to define new virtual servers simply by placing
#	a file into the raddb/sites-enabled/ directory.
#
$INCLUDE sites-enabled/

######################################################################
#
#	All of the other configuration sections like "authorize {}",
#	"authenticate {}", "accounting {}", have been moved to the
#	the file:
#
#		raddb/sites-available/default
#
#	This is the "default" virtual server that has the same
#	configuration as in version 1.0.x and 1.1.x.  The default
#	installation enables this virtual server.  You should
#	edit it to create policies for your local site.
#
#	For more documentation on virtual servers, see:
#
#		raddb/sites-available/README
#
######################################################################
